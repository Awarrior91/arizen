<!DOCTYPE html>
<html>
<head>
    <title>Arizen: Password Verification</title>
    <script src="https://code.jquery.com/jquery-1.7.min.js"></script>
    <link rel="stylesheet" href="resources/login_styles.css">
</head>
<body>


<div id="container">
    <h1>Password Verification</h1>
    <form>
        <ul>
            <li>
                <label for="username">Username:</label>
                <span><input id="username" name="username" type="text"/></span>
            </li>
            <li>
                <label for="pswd">Password:</label>
                <span><input id="pswd" name="pswd" type="password"/></span>
            </li>
            <li>
                <label for="pswd_again">Password again:</label>
                <span><input id="pswd_again" name="pswd_again" type="password"/></span>
            </li>
            <li>
                <button id="btSubmit" name="btSubmit" type="submit" disabled onclick="loginExist()">Register</button>
            </li>
        </ul>
    </form>
    <div id="username_info">
        <h4>Username must meet the following requirements:</h4>
        <ul>
            <li id="usrnm_length_info" class="invalid">At least <strong>four letters</strong></li>
        </ul>
    </div>
    <div id="pswd_info">
        <h4>Password must meet the following requirements:</h4>
        <ul>
            <li id="letter_info" class="invalid">At least <strong>one letter</strong></li>
            <li id="capital_info" class="invalid">At least <strong>one capital letter</strong></li>
            <li id="number_info" class="invalid">At least <strong>one number</strong></li>
            <li id="length_info" class="invalid">Be at least <strong>8 characters</strong></li>
        </ul>
    </div>
    <div id="pswd_identical_info">
        <h4>Password must meet the following requirements:</h4>
        <ul>
            <li id="identical_info" class="invalid"><strong>Identical</strong></li>
        </ul>
    </div>
</div>

<script>
    function loginExist() {
        const fs = require("fs");
        let path = require("./common.js").getLoginPath();

        fs.stat(path, function (err, stat) {
            if (err === null) {
                console.log("File exists");
                return true;
            } else if (err.code === "ENOENT") {
                console.log("File does not exists");
                return false;
            }
//            else {
//                console.log("Some other error: ", err.code);
//                return;
//            }
        });
    }

    function showRegisterOrLogin() {
        if (loginExist()) {
            // you know your login
        } else {
            // you are new here
        }
        document.getElementById("receive").style.display = "none";
        document.getElementById("send").style.display = "block";
    }

    $(document).ready(function () {
        $(':input[id="btSubmit"]').prop('disabled', true);
        let usr_val = null;
        let pswd_val = null;
        let pswd_again_val = null;
        let usr = false;
        let len = false;
        let lett = false;
        let capl = false;
        let num = false;
        let ide = false;

        $('input[id=username]').keyup(function () {
            usr_val = $(this).val();

            // validate the length
            if (usr_val.length < 4) {
                $('#usrnm_length_info').removeClass('valid').addClass('invalid');
                usr = false;
            } else {
                $('#usrnm_length_info').removeClass('invalid').addClass('valid');
                usr = true;
            }
        }).focus(function () {
            // focus code here
            $('#username_info').show();
        }).blur(function () {
            // blur code here
            $('#username_info').hide();
        });

        $('input[id=pswd]').keyup(function () {
            // keyup event code here
            // set password variable
            pswd_val = $(this).val();

            // validate the length
            if (pswd_val.length < 8) {
                $('#length_info').removeClass('valid').addClass('invalid');
                len = false;
            } else {
                $('#length_info').removeClass('invalid').addClass('valid');
                len = true;
            }

            // validate letter
            if (pswd_val.match(/[A-z]/)) {
                $('#letter_info').removeClass('invalid').addClass('valid');
                lett = true;
            } else {
                $('#letter_info').removeClass('valid').addClass('invalid');
                lett = false;
            }

            // validate capital letter
            if (pswd_val.match(/[A-Z]/)) {
                $('#capital_info').removeClass('invalid').addClass('valid');
                capl = true;
            } else {
                $('#capital_info').removeClass('valid').addClass('invalid');
                capl = false;
            }

            // validate number
            if (pswd_val.match(/\d/)) {
                $('#number_info').removeClass('invalid').addClass('valid');
                num = true;
            } else {
                $('#number_info').removeClass('valid').addClass('invalid');
                num = false;
            }
        }).focus(function () {
            // focus code here
            $('#pswd_info').show();
        }).blur(function () {
            // blur code here
            $('#pswd_info').hide();
        });

        $('input[id=pswd_again]').keyup(function () {
            // keyup event code here
            pswd_again_val = $(this).val();
            // console.log(pswd);
            // console.log(pswd_again);
            // validate if passwords are identical
            if (pswd_val === pswd_again_val) {
                $('#identical_info').removeClass('invalid').addClass('valid');
                ide = true;
            } else {
                $('#identical_info').removeClass('valid').addClass('invalid');
                ide = false;
            }
        }).focus(function () {
            // focus code here
            $('#pswd_identical_info').show();
        }).blur(function () {
            // blur code here
            $('#pswd_identical_info').hide();
        });

        $('input[id="username"], input[id="pswd"], input[id="pswd_again"]').keyup(function() {
            if($(this).val() != '') {
                console.log(usr, len, lett, capl, num, ide);
                if(usr && len && lett && capl && num && ide){
                    $(':input[type="submit"]').prop('disabled', false);
                }
            }
        });
    });
</script>
</body>
</html>